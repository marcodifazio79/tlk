
 CREATE TABLE `Machines` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ip_address` varchar(15) NOT NULL,
  `imei` BIGINT DEFAULT NULL,
  `mid` varchar(50) DEFAULT NULL,
  `version` varchar(10) DEFAULT NULL,
  `last_communication` timestamp DEFAULT CURRENT_TIMESTAMP,
  `time_creation` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `index_ip_mid` (`ip_address`,`mid`),
  KEY `index_mid` (`mid`),
  KEY `index_imei` (`imei`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

 CREATE TABLE `MachinesConnectionTrace` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `time_stamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `ip_address` varchar(15) NOT NULL,
  `send_or_recv` varchar(4) NOT NULL,
  `transferred_data` varchar(10000) NOT NULL,
  `id_Macchina` int(11) DEFAULT NULL,
  KEY `index_ip_address` (`ip_address`),
  KEY `index_time_stamp` (`time_stamp`),
  KEY `index_id_Macchina` (`id_Macchina`),
  
  PRIMARY KEY (`id`),
  FOREIGN KEY (`id_Macchina`)
        REFERENCES Machines(id)
        ON DELETE NO ACTION

) ENGINE=InnoDB DEFAULT CHARSET=latin1;




 CREATE TABLE `Machines_InMemory` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ip_address` varchar(15) NOT NULL,
  `tcp_local_port` int(11) NOT NULL,
  `mid` varchar(50) DEFAULT NULL,
  `time_creation` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `mid` (`mid`),
  KEY `index_ip_address` (`ip_address`),
  KEY `index_mid` (`mid`),
  KEY `index_local_port` (`tcp_local_port`)
) ENGINE=MEMORY DEFAULT CHARSET=latin1;

 CREATE TABLE `dump` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `data` varchar(10000) NOT NULL,
  `timeStamp` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=22516 DEFAULT CHARSET=latin1;


 CREATE TABLE `RemoteCommand` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `body` varchar(10000) NOT NULL,
  `ReceivedAt` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `SendedAt` datetime DEFAULT NULL,
  `AnsweredAt` datetime DEFAULT NULL,
  `Sender` varchar(15) NOT NULL,
  `id_Macchina` int(11) DEFAULT NULL,
  `LifespanSeconds` int(11) DEFAULT 15,
  `Status` varchar(15) NOT NULL,
  KEY `index_ID_Macchina` (`id_Macchina`),
  PRIMARY KEY (`id`),
    FOREIGN KEY (`id_Macchina`)
        REFERENCES Machines(id)
        ON DELETE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=22516 DEFAULT CHARSET=latin1;



 CREATE TABLE `CommandsMatch` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ModemCommand` varchar(15) NOT NULL,
  `WebCommand` varchar(30) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=22516 DEFAULT CHARSET=latin1;


 CREATE TABLE `MachineExtendedAttributes` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `id_Macchina` int(11) NOT NULL,
  `is_Online`  BOOLEAN,
  `LGG_Value` int DEFAULT NULL,
  `LGG_Value_Updated_At` datetime DEFAULT NULL,
  `LGA_Value` int DEFAULT NULL,
  `LGA_Value_Updated_At` datetime DEFAULT NULL,
  `KAL_Value` int DEFAULT NULL,
  `KAL_Value_Updated_At` datetime DEFAULT NULL,
  `MPV_Value` int DEFAULT NULL,
  `MPV_Value_Updated_At` datetime DEFAULT NULL,
  `PPC_Value` int DEFAULT NULL,
  `PPC_Value_Updated_At` datetime DEFAULT NULL,
  `CH1_Value` int DEFAULT NULL,
  `CH1_Value_Updated_At` datetime DEFAULT NULL,
  `CH2_Value` int DEFAULT NULL,
  `CH2_Value_Updated_At` datetime DEFAULT NULL,
  `CH3_Value` int DEFAULT NULL,
  `CH3_Value_Updated_At` datetime DEFAULT NULL,
  `CH4_Value` int DEFAULT NULL,
  `CH4_Value_Updated_At` datetime DEFAULT NULL,
  `CH5_Value` int DEFAULT NULL,
  `CH5_Value_Updated_At` datetime DEFAULT NULL,
  `CH6_Value` int DEFAULT NULL,
  `CH6_Value_Updated_At` datetime DEFAULT NULL,
  `CH7_Value` int DEFAULT NULL,
  `CH7_Value_Updated_At` datetime DEFAULT NULL,
  `CH8_Value` int DEFAULT NULL,
  `CH8_Value_Updated_At` datetime DEFAULT NULL,
  
  KEY `index_ID_Macchina` (`id_Macchina`),
  PRIMARY KEY (`id`),
    FOREIGN KEY (`id_Macchina`)
        REFERENCES Machines(id)
        ON DELETE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=latin1;

create trigger Machines_Ext_trig after insert on Machines
for each row
insert into MachineExtendedAttributes (id_Macchina, is_Online) values (new.id, TRUE);